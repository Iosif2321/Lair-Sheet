{
  "name": "Поставить POI",
  "type": "script",
  "scope": "global",
  "author": "N5s4uI6OpcSYQoF8",
  "img": "icons/tools/navigation/map-marked-red.webp",
  "command": "// Этот макрос создаёт активный тайл на выбранной сцене. Требуется активный модуль Monk's Active Tile Triggers\n // При запуске макроса открывается диалоговое окно, в котором вы можете выбрать сцену.\n // После выбора сцены нажмите \"Выбрать\" и щелкните левой кнопкой мыши на месте на карте, где должен появиться активный тайл. Версия 29.08.24\n\n\nlet dialogContent = `<form>\n  <div class=\"form-group\" style=\"display: block;\">\n   <p>Выберите сцену, нажмите \"Выбрать\" и щелкните левой кнопкой мыши на месте карты, где должен появиться активный тайл.</p>\n   <p><label style=\"display: block;\">Выбор сцены:</label></p>\n    <select id=\"scene-selection\" name=\"scene-selection\">`;\n\nfor(let scene of game.scenes.values()) {\n  dialogContent += `<option value=\"${scene.id}\">${scene.name}</option>`;\n}\n\ndialogContent += `</select>\n  </div>\n</form>`;\n\nlet d = new Dialog({\n  title: \"Выберете сцену для размещения POI\",\n  content: dialogContent,\n  buttons: {\n    ok: {\n      icon: '<i class=\"fas fa-check\"></i>',\n      label: \"Выбрать\",\n      callback: async (html) => {\n        let sceneId = html.find('[name=\"scene-selection\"]').val();\n\n        // Создайте новый тайл\n        let newTileData = {\n          img: \"icons/pings/chevron.webp\",\n          x: 0,  // Будет обновлено с указанием местоположения клика\n          y: 0,  // Будет обновлено с указанием местоположения клика\n          width: 50,\n          height: 50,\n          rotation: 0,\n          z: 100,\n          alpha: 1,\n          hidden: false,\n          overhead: false,\n          locked: false,\n          roof: false,\n          occlusion: {\n            mode: 1,\n            alpha: 0,\n            radius: null\n          },\n          video: {\n            loop: true,\n            autoplay: true,\n            volume: 0\n          },\n          flags: {\n            \"monks-active-tiles\": {\n              active: true,\n              record: false,\n              restriction: \"gm\",\n              controlled: \"gm\",\n              trigger: [\n                \"\",\n                \"click\"\n              ],\n              allowpaused: true,\n              usealpha: false,\n              pointer: true,\n              pertoken: false,\n              minrequired: 0,\n              chance: 100,\n              fileindex: 0,\n              actions: [\n                {\n                  action: \"scene\",\n                  data: {\n                    sceneid: sceneId,\n                    activate: false\n                  }\n                }\n              ],\n              files: []\n            }\n          }\n        };\n        // Нажмите на холст, чтобы узнать местоположение нового тайла.\n        canvas.app.stage.on('pointerdown', async function onClick(event) {\n          // Преобразование положения указателя в глобальные координаты\n          let position = event.getLocalPosition(canvas.app.stage);\n          newTileData.x = position.x;\n          newTileData.y = position.y;\n\n          // Создайте тайл в текущей просматриваемой сцене\n          let scene = game.scenes.viewed;\n          await scene.createEmbeddedDocuments(\"Tile\", [newTileData]);\n\n          // Удаление обработчика нажатий после создания тайла\n          canvas.app.stage.off('pointerdown', onClick);\n        });\n      }\n    },\n    cancel: {\n      icon: '<i class=\"fas fa-times\"></i>',\n      label: \"Отмена\"\n    }\n  }\n}).render(true);",
  "ownership": {
    "default": 0,
    "N5s4uI6OpcSYQoF8": 3
  },
  "flags": {
    "combat-utility-belt": {
      "macroTrigger": ""
    },
    "exportSource": {
      "world": "vbna",
      "system": "dnd5e",
      "coreVersion": "10.291",
      "systemVersion": "2.1.5"
    },
    "core": {
      "sourceId": "Macro.EXQ6Qegsae9YSGFo"
    }
  },
  "_stats": {
    "systemId": "dnd5e",
    "systemVersion": "3.3.1",
    "coreVersion": "12.331",
    "createdTime": 1684308830935,
    "modifiedTime": 1724926557100,
    "lastModifiedBy": "qOtQQXn0PijCSOuU",
    "compendiumSource": "Macro.EXQ6Qegsae9YSGFo",
    "duplicateSource": null
  },
  "folder": "vwyjREHxtAnaLnqX",
  "sort": 400000,
  "_id": "AuniXLI8dWYDlzIQ",
  "_key": "!macros!AuniXLI8dWYDlzIQ"
}
