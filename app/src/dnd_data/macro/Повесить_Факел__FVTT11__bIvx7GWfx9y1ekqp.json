{
  "name": "Повесить Факел (FVTT11)",
  "type": "script",
  "scope": "global",
  "author": "N5s4uI6OpcSYQoF8",
  "img": "icons/sundries/lights/torch-brown-lit.webp",
  "command": "// Глобальная функция для обработки клика. Требуется установленный модуль Monk's Active Tile Trigger для работы выключателя\nwindow.handleTileAndLightCreation = async function(event) {\n  let position = event.data.getLocalPosition(canvas.app.stage);\n\n  let lightData = {\n    t: \"l\",\n    x: position.x,\n    y: position.y,\n    rotation: 0,\n    dim: 40,\n    bright: 20,\n    angle: 360,\n    tintColor: \"#fa4300\",\n    lightAlpha: 0.3,\n    coloration: 1,\n    attenuation: 0.3,\n    luminosity: 0.3,\n    saturation: 0,\n    contrast: 0,\n    shadows: 0,\n    darkness: {\n      min: 0,\n      max: 1\n    },\n    lightAnimation: {\n        type: \"flame\",\n        speed: 3,\n        intensity: 3,\n        reverse: false\n    }\n};\n\n  let scene = game.scenes.viewed;\n  let light = await scene.createEmbeddedDocuments(\"AmbientLight\", [lightData]);\n\n  let newTileData = {\n    texture: {\n      src: \"icons/sundries/lights/torch-brown-lit.webp\",\n      scaleX: 1,\n      scaleY: 1,\n      offsetX: 0,\n      offsetY: 0,\n      rotation: 0,\n      tint: null\n    },\n    x: position.x,\n    y: position.y,\n    width: 40,\n    height: 40,\n    overhead: false,\n    z: 100,\n    rotation: 0,\n    alpha: 1,\n    hidden: true,\n    locked: false,\n    roof: false,\n    occlusion: {\n      mode: 1,\n      alpha: 0,\n      radius: null\n    },\n    video: {\n      loop: true,\n      autoplay: true,\n      volume: 0\n    },\n    flags: {\n      tagger: {},\n      \"monks-active-tiles\": {\n        active: true,\n        record: false,\n        restriction: \"all\",\n        controlled: \"all\",\n        trigger: [\"\", \"click\"],\n        allowpaused: true,\n        usealpha: false,\n        pointer: true,\n        pertoken: false,\n        minrequired: 0,\n        chance: 50,\n        fileindex: 0,\n        actions: [\n          {\n            action: \"activate\",\n            data: {\n              entity: {\n                id: `Scene.${scene.data._id}.AmbientLight.${light[0].data._id}`,\n                name: `AmbientLight: ${light[0].data._id}`\n              },\n              collection: \"tiles\",\n              activate: \"toggle\"\n            },\n            id: `${light[0].data._id}`\n          }\n        ],\n        files: []\n      }\n    }\n  };\n\n  await scene.createEmbeddedDocuments(\"Tile\", [newTileData]);\n\n  // Удалите обработчик события после его выполнения\n  canvas.app.stage.off('pointerdown', window.handleTileAndLightCreation);\n};\n\n// Макрос для установки обработчика события\ncanvas.app.stage.on('pointerdown', window.handleTileAndLightCreation);",
  "ownership": {
    "default": 0,
    "N5s4uI6OpcSYQoF8": 3
  },
  "flags": {
    "combat-utility-belt": {
      "macroTrigger": ""
    },
    "exportSource": {
      "world": "vbna",
      "system": "dnd5e",
      "coreVersion": "10.291",
      "systemVersion": "2.1.5"
    },
    "core": {
      "sourceId": "Macro.SPDGZN196mankwSf"
    }
  },
  "_stats": {
    "systemId": "dnd5e",
    "systemVersion": "3.3.1",
    "coreVersion": "12.331",
    "createdTime": 1684312648455,
    "modifiedTime": 1724925748707,
    "lastModifiedBy": "qOtQQXn0PijCSOuU",
    "compendiumSource": "Macro.SPDGZN196mankwSf",
    "duplicateSource": null
  },
  "folder": "vwyjREHxtAnaLnqX",
  "sort": 187500,
  "_id": "bIvx7GWfx9y1ekqp",
  "_key": "!macros!bIvx7GWfx9y1ekqp"
}
