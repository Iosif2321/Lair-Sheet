{
  "name": "Особенность \"Разделение\"",
  "type": "script",
  "scope": "global",
  "author": "N5s4uI6OpcSYQoF8",
  "img": "icons/creatures/slimes/slime-movement-splashing-yellow.webp",
  "command": "// Макрос, который позволяет \"разделить\" токен на две части, с  делением ПЗ. \nlet update = {};\n\n\n  // Halve health\n  const currentHealth = token.actor.system.attributes.hp.value;\n  const newHealth = Math.floor(currentHealth / 2);\n  update[\"system.attributes.hp.value\"] = newHealth;\n\n  // Choose next size down\n  const currentSize = token.actor.system.traits.size;\n  let newSize = \"tiny\";\n  let scale = 1.3;\n  let dimensions = 0.5;\n  if ( currentSize == \"lg\" ) {\n\tnewSize = \"med\";\n\tdimensions = 1;\n  }\n  else if ( currentSize == \"med\" ) {\n\tnewSize = \"sm\";\n\tscale = 0.9;\n\tdimensions = 1;\n  }\n\n  // Remove AE's\n  update[\"effects\"] = [];\n\n  // Execute Actor updates\n  update[\"system.traits.size\"] = newSize;\n  await token.actor.update(update);\n\n  // Spawn new cloned Token\n  const existingToken = canvas.tokens.get(token.document.id);\n  const newToken = foundry.utils.duplicate(existingToken.document);\n  let created = await canvas.scene.createEmbeddedDocuments(\"Token\", [newToken], {});\n\n  // Execute Canvas updates\n  newToken.x += canvas.dimensions.size * dimensions;\n  await canvas.scene.updateEmbeddedDocuments(\"Token\", [{\"_id\": token.document.id, \"texture.scaleX\": scale, \"texture.scaleY\": scale, \"width\": dimensions, \"height\": dimensions}, {\"_id\": created[0]._id, \"texture.scaleX\": scale, \"texture.scaleY\": scale, \"width\": dimensions, \"height\": dimensions, \"x\": newToken.x}], {animation: {duration: 2000}});",
  "ownership": {
    "default": 0,
    "N5s4uI6OpcSYQoF8": 3
  },
  "flags": {
    "exportSource": {
      "world": "houz",
      "system": "dnd5e",
      "coreVersion": "10.291",
      "systemVersion": "2.1.5"
    },
    "core": {
      "sourceId": "Macro.hS0FfulgrFyyyzT3"
    }
  },
  "_stats": {
    "systemId": "dnd5e",
    "systemVersion": "2.3.1",
    "coreVersion": "12.331",
    "createdTime": 1665156917453,
    "modifiedTime": 1699263558077,
    "lastModifiedBy": "H9WsizrOeJscXSvG",
    "compendiumSource": "Macro.hS0FfulgrFyyyzT3",
    "duplicateSource": null
  },
  "folder": "vwyjREHxtAnaLnqX",
  "sort": 175000,
  "_id": "U5hixeM4EDypss1b",
  "_key": "!macros!U5hixeM4EDypss1b"
}
